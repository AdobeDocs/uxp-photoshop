(self.webpackChunkuxp_photoshop_documentation=self.webpackChunkuxp_photoshop_documentation||[]).push([[6223],{77411:function(e,t,a){"use strict";a.r(t),a.d(t,{_frontmatter:function(){return l},default:function(){return d}});var n=a(22122),o=a(19756),s=(a(15007),a(64983)),i=a(99536),r=["components"],l={},c={_frontmatter:l},p=i.Z;function d(e){var t=e.components,a=(0,o.Z)(e,r);return(0,s.mdx)(p,(0,n.Z)({},c,a,{components:t,mdxType:"MDXLayout"}),(0,s.mdx)("h1",{id:"executeasmodal"},"ExecuteAsModal"),(0,s.mdx)("p",null,"ExecuteAsModal is needed when a plugin wants to make modifications to the Photoshop state. This includes scenarios where the plugin creates or modify documents, or the plugin wishes to update UI or preference state."),(0,s.mdx)("p",null,"ExecuteAsModal is only available to a plugin that is using apiVersion 2 or higher."),(0,s.mdx)("p",null,"Only one plugin at a time can use ",(0,s.mdx)("inlineCode",{parentName:"p"},"executeAsModal"),", and this means that executeAsModal guarantees that the plugin gets exclusive access to Photoshop."),(0,s.mdx)("p",null,'When executeAsModal is active, then Photoshop enters a modal user interaction state. This means that some menu items are disabled.\nIf the modal state lasts a significant amount of time (currently more than two seconds), then a progress bar is shown. The progress bar will identify the plugin that is associated with the modal state, and it will include the ability for the user to cancel the interaction. The following illustrates the progress bar that would be created for a plugin called "Sample Plugin". The progress bar is indefinite until the plugin informs Photoshop about its progress.'),(0,s.mdx)("p",null,(0,s.mdx)("span",{parentName:"p",className:"gatsby-resp-image-wrapper",style:{position:"relative",display:"block",marginLeft:"auto",marginRight:"auto",maxWidth:"960px"}},"\n      ",(0,s.mdx)("span",{parentName:"span",className:"gatsby-resp-image-background-image",style:{paddingBottom:"22.499999999999996%",position:"relative",bottom:"0",left:"0",display:"block",transition:"opacity 0.5s 0.5s",pointerEvents:"none"}}),"\n  ",(0,s.mdx)("picture",{parentName:"span"},"\n          ",(0,s.mdx)("source",{parentName:"picture",srcSet:["/uxp-photoshop/static/0a90fc45778667dad31f651d6dbda964/cb523/progress-bar.webp 320w","/uxp-photoshop/static/0a90fc45778667dad31f651d6dbda964/797b9/progress-bar.webp 640w","/uxp-photoshop/static/0a90fc45778667dad31f651d6dbda964/6c7d1/progress-bar.webp 960w"],sizes:"(max-width: 960px) 100vw, 960px",type:"image/webp"}),"\n          ",(0,s.mdx)("source",{parentName:"picture",srcSet:["/uxp-photoshop/static/0a90fc45778667dad31f651d6dbda964/72799/progress-bar.png 320w","/uxp-photoshop/static/0a90fc45778667dad31f651d6dbda964/6af66/progress-bar.png 640w","/uxp-photoshop/static/0a90fc45778667dad31f651d6dbda964/d9199/progress-bar.png 960w"],sizes:"(max-width: 960px) 100vw, 960px",type:"image/png"}),"\n          ",(0,s.mdx)("img",{parentName:"picture",className:"gatsby-resp-image-image",src:"/uxp-photoshop/static/0a90fc45778667dad31f651d6dbda964/d9199/progress-bar.png",alt:"progress bar",title:"progress bar",loading:"lazy",style:{width:"100%",height:"100%",margin:"0",verticalAlign:"middle",position:"absolute",opacity:"0",transition:"opacity 0.5s",color:"inherit",boxShadow:"inset 0px 0px 0px 400px none",top:"0",left:"0"}}),"\n        "),"\n    ")),(0,s.mdx)("p",null,"When a plugin is inside a modal scope, then it controls Photoshop. This means that you no longer need to use options such as ",(0,s.mdx)("inlineCode",{parentName:"p"},"modalBehavior")," with ",(0,s.mdx)("inlineCode",{parentName:"p"},"batchPlay"),"."),(0,s.mdx)("h2",{id:"api"},"API"),(0,s.mdx)("p",null,"ExecuteAsModal is exposed on the Photoshop core module."),(0,s.mdx)("pre",null,(0,s.mdx)("code",{parentName:"pre",className:"language-javascript"},"require('photoshop').core.executeAsModal(targetFunction, options);\n")),(0,s.mdx)("p",null,"targetFunction is a JavaScript function that will be executed after Photoshop enters a modal state. When the targetFunction completes, then Photoshop will exit the modal state. The targetFunction can be asynchronous."),(0,s.mdx)("p",null,"Only one plugin can be modal at any given time. If another plugin is modal when you call executeAsModal, then executeAsModal will raise an error. It is therefore important to handle errors when calling this method."),(0,s.mdx)("p",null,"It is also recommended that JavaScript awaits on the result from executeAsModal. Without an await, JavaScript will proceed to the subsequent lines of code while Photoshop enters a modal state."),(0,s.mdx)("p",null,"A typical use case is:"),(0,s.mdx)("pre",null,(0,s.mdx)("code",{parentName:"pre",className:"language-javascript"},'try {\n    await require(\'photoshop\').core.executeAsModal(targetFunction, {"commandName": "My Script Command"});\n    }\n    catch(e) {\n      if (e.number == 9) {\n          showAlert("executeAsModal was rejected (some other plugin is currently inside a modal scope)");\n      }\n      else {\n        // This case is hit if the targetFunction throws an exception\n      }\n    }\n')),(0,s.mdx)("h3",{id:"details"},"Details"),(0,s.mdx)("p",null,"executeAsModal takes the following arguments:"),(0,s.mdx)("ol",null,(0,s.mdx)("li",{parentName:"ol"},"targetFunction: The JavaScript function to execute after Photoshop enters a modal state."),(0,s.mdx)("li",{parentName:"ol"},"options: Options describing the request. The following properties are recognized:",(0,s.mdx)("ol",{parentName:"li"},(0,s.mdx)("li",{parentName:"ol"},"commandName (required): A string describing the command. This string is shown in the progress bar UI."),(0,s.mdx)("li",{parentName:"ol"},"descriptor (optional): An object with command arguments. See documentation for targetFunction below.")))),(0,s.mdx)("p",null,"The JavaScript target function has the following signature:"),(0,s.mdx)("pre",null,(0,s.mdx)("code",{parentName:"pre",className:"language-javascript"},"async function targetFunction(executionContext, descriptor)\n")),(0,s.mdx)("p",null,"The executionContext contains functionality related to managing the modal state."),(0,s.mdx)("p",null,"The descriptor contains the values provided to the descriptor property in the options argument to executeAsModal."),(0,s.mdx)("p",null,"The executionContext contains the following properties:"),(0,s.mdx)("ul",null,(0,s.mdx)("li",{parentName:"ul"},"isCancelled: A boolean that is true if the user has cancelled the modal interaction."),(0,s.mdx)("li",{parentName:"ul"},"onCancel: A function property. If JavaScript assigns a function to this property, then this function is executed if the user cancels the modal interaction."),(0,s.mdx)("li",{parentName:"ul"},"reportProgress: A function that JavaScript can use to customize the progress bar. See below for details."),(0,s.mdx)("li",{parentName:"ul"},"hostControl: An object containing the following properties:",(0,s.mdx)("ul",{parentName:"li"},(0,s.mdx)("li",{parentName:"ul"},"suspendHistory. A function that can be used to suspend history on a target document. See below for details."),(0,s.mdx)("li",{parentName:"ul"},"resumeHistory. A function that can be used to resume history on a target document. See below for details."),(0,s.mdx)("li",{parentName:"ul"},"registerAutoCloseDocument. Register a document to be closed when the modal scope exits. See below for details."))),(0,s.mdx)("li",{parentName:"ul"},"unregisterAutoCloseDocument. Unregister a document from being closed when the modal scope exits. See below for details.")),(0,s.mdx)("h4",{id:"user-cancellation"},"User cancellation"),(0,s.mdx)("p",null,"executeAsModal puts Photoshop into a modal state, and it is important to allow the user to exit this state if the command was invoked by mistake, or if the command is taking too much time."),(0,s.mdx)("p",null,"The user can cancel the operation by pressing the Escape key or using cancellation UI in the progress bar.\nIf the user cancels the interaction, then JavaScript should return from its target function as soon as possible.\nJavaScript can use ",(0,s.mdx)("inlineCode",{parentName:"p"},"isCancelled")," and ",(0,s.mdx)("inlineCode",{parentName:"p"},"onCancel")," on the executionContext to get information about the current user cancellation state. In addition to this, Photoshop APIs such as ",(0,s.mdx)("inlineCode",{parentName:"p"},"batchPlay")," will raise an exception if they are invoked from a target function after the user has cancelled the interaction."),(0,s.mdx)("p",null,"The following is an example of a target JavaScript function:"),(0,s.mdx)("pre",null,(0,s.mdx)("code",{parentName:"pre",className:"language-javascript"},'async function targetFunction(executionControl, descriptor) {\n  let target = {_ref:[{_ref:"property", "_property": "hostName"}, {"_ref":"application","_enum":"ordinal","_value":"targetEnum"}]};\n  let command = {"_obj": "get", "_target": target};\n  while (true) {\n    await psAction.batchPlay([command], {});\n  }\n}\nawait require("photoshop").core.executeAsModal(targetFunction, {"commandName": "User Cancel Test"});\n')),(0,s.mdx)("p",null,"This sample will run until the user cancels the interaction. After the user cancels, the modal scope becomes cancelled, and the next call to batchPlay will raise an exception and exit the target function."),(0,s.mdx)("p",null,"Due to the design of the underlying JavaScript runtime, JavaScript can only be cancelled when it is ",(0,s.mdx)("em",{parentName:"p"},"interruptible"),'. JavaScript can be interrupted when it is waiting on the resolution of a promise. Without the "await" keyword in the above example, the JavaScript function would not terminate when the user cancels. Having a tight loop such as the following also does not allow for automatic cancellation of the JavaScript function.'),(0,s.mdx)("pre",null,(0,s.mdx)("code",{parentName:"pre"},"async function targetFunction(executionControl) {\n  while (true) {\n    calculateSomeDigitsOfPi();\n  }\n}\n")),(0,s.mdx)("p",null,"JavaScript that runs for a significant amount of time without an interruption point should regularly query isCancelled on the executionContext. The JavasScript example above can be made cancellable by modifying it to the following:"),(0,s.mdx)("pre",null,(0,s.mdx)("code",{parentName:"pre",className:"language-javascript"},'async function targetFunction(executionControl) {\n  while (true) {\n    calculateSomeDigitsOfPi();\n    if (executionContext.isCancelled) {\n      throw "user cancelled";\n    }\n  }\n}\n')),(0,s.mdx)("p",null,'When the JavaScript function uses "await" with a Photoshop JavaScript command, then it is automatically terminated if the user cancels the operation. The automatic cancellation relies on JavaScript exceptions, and it is therefore important to not discard exceptions. The following function discards exceptions around batchPlay and will therefore ',(0,s.mdx)("em",{parentName:"p"},"not")," be automatically terminated when the user cancels the interaction."),(0,s.mdx)("pre",null,(0,s.mdx)("code",{parentName:"pre",className:"language-javascript"},'async function targetFunction(executionControl) {\n  let target = {_ref:[{_ref:"property", "_property": "hostName"}, {"_ref":"application","_enum":"ordinal","_value":"targetEnum"}]};\n  let command = {"_obj": "get", "_target": target};\n  while (true) {\n    try {\n       await psAction.batchPlay([command], {});\n    } catch (e) {}\n  }\n}\nawait require("photoshop").core.executeAsModal(targetFunction, {"commandName": "User Cancel Test"});\n')),(0,s.mdx)("h4",{id:"progress-bar"},"Progress bar"),(0,s.mdx)("p",null,"By default, Photoshop shows an indeterminate progress bar while a modal scope is active. The progress bar is shown a few seconds after the modal scope is initiated.\nJavaScript can use ",(0,s.mdx)("inlineCode",{parentName:"p"},"reportProgress")," to customize this behavior. To obtain a determinate progress bar, JavaScript can specify a value between 0 and 1 when calling reportProgress. Example:"),(0,s.mdx)("pre",null,(0,s.mdx)("code",{parentName:"pre",className:"language-javascript"},'async function targetFunction(executionControl) {\n  executionControl.reportProgress({"value": 0.3});\n}\n')),(0,s.mdx)("p",null,"Setting a value will switch the progress bar to be a determinate progress bar & show the progress bar if it is not yet visible."),(0,s.mdx)("p",null,'JavaScript can change the commandName that is shown in the progress UI by using the "commandName" property. This can be used to inform the user about the current stage of the operation. Example:'),(0,s.mdx)("pre",null,(0,s.mdx)("code",{parentName:"pre",className:"language-javascript"},'    executionControl.reportProgress({"value": 0.9, "commandName": "Finishing Up"});\n')),(0,s.mdx)("p",null,(0,s.mdx)("span",{parentName:"p",className:"gatsby-resp-image-wrapper",style:{position:"relative",display:"block",marginLeft:"auto",marginRight:"auto",maxWidth:"968px"}},"\n      ",(0,s.mdx)("span",{parentName:"span",className:"gatsby-resp-image-background-image",style:{paddingBottom:"23.4375%",position:"relative",bottom:"0",left:"0",display:"block",transition:"opacity 0.5s 0.5s",pointerEvents:"none"}}),"\n  ",(0,s.mdx)("picture",{parentName:"span"},"\n          ",(0,s.mdx)("source",{parentName:"picture",srcSet:["/uxp-photoshop/static/2e9adeb2a03e5b642b890042878177d5/cb523/progress-bar-2.webp 320w","/uxp-photoshop/static/2e9adeb2a03e5b642b890042878177d5/797b9/progress-bar-2.webp 640w","/uxp-photoshop/static/2e9adeb2a03e5b642b890042878177d5/cece5/progress-bar-2.webp 968w"],sizes:"(max-width: 968px) 100vw, 968px",type:"image/webp"}),"\n          ",(0,s.mdx)("source",{parentName:"picture",srcSet:["/uxp-photoshop/static/2e9adeb2a03e5b642b890042878177d5/72799/progress-bar-2.png 320w","/uxp-photoshop/static/2e9adeb2a03e5b642b890042878177d5/6af66/progress-bar-2.png 640w","/uxp-photoshop/static/2e9adeb2a03e5b642b890042878177d5/e2310/progress-bar-2.png 968w"],sizes:"(max-width: 968px) 100vw, 968px",type:"image/png"}),"\n          ",(0,s.mdx)("img",{parentName:"picture",className:"gatsby-resp-image-image",src:"/uxp-photoshop/static/2e9adeb2a03e5b642b890042878177d5/e2310/progress-bar-2.png",alt:"progress bar",title:"progress bar",loading:"lazy",style:{width:"100%",height:"100%",margin:"0",verticalAlign:"middle",position:"absolute",opacity:"0",transition:"opacity 0.5s",color:"inherit",boxShadow:"inset 0px 0px 0px 400px none",top:"0",left:"0"}}),"\n        "),"\n    ")),(0,s.mdx)("p",null,"The progress bar is hidden while modal UI is shown."),(0,s.mdx)("h4",{id:"history-state-suspension"},"History state suspension"),(0,s.mdx)("p",null,"The hostControl property on the executionContext can be used to suspend and resume history states. While a history state is suspended, Photoshop will coalesce all document changes into a single history state with a custom name."),(0,s.mdx)("p",null,"Example:"),(0,s.mdx)("pre",null,(0,s.mdx)("code",{parentName:"pre",className:"language-javascript"},'async function historyStateSample(executionContext) {\n    let hostControl = executionContext.hostControl;\n\n    // Get an ID for a target document\n    let documentID = await getTargetDocument();\n\n    // Suspend history state on the target document\n    // This will coalesce all changes into a single history state called\n    // \'Custom Command\'\n    let suspensionID = await hostControl.suspendHistory({\n        "documentID": documentID,\n        "name": "Custom Command"\n    });\n\n    // modify the document\n    // . . .\n\n    // resume the history state\n    await hostControl.resumeHistory(suspensionID);\n}\n')),(0,s.mdx)("p",null,"The signature for suspendHistory is:"),(0,s.mdx)("pre",null,(0,s.mdx)("code",{parentName:"pre",className:"language-javascript"},"executionContext.hostControl.suspendHistory(options)\n")),(0,s.mdx)("p",null,"The options argument is an object with the following properties:"),(0,s.mdx)("ul",null,(0,s.mdx)("li",{parentName:"ul"},"documentID: The ID of the document whose history state should be suspended."),(0,s.mdx)("li",{parentName:"ul"},"name: The name that is used for the history state. This is visible in the History panel.\nsuspendHistory returns a suspension identifier. This identifier should be used with resumeHistory.")),(0,s.mdx)("p",null,"The signature for resumeHistory is:"),(0,s.mdx)("pre",null,(0,s.mdx)("code",{parentName:"pre",className:"language-javascript"},"executionContext.hostControl.resumeHistory(suspensionID, commit)\n")),(0,s.mdx)("ul",null,(0,s.mdx)("li",{parentName:"ul"},"suspensionID: the suspension identifier that was returned from suspendHistory."),(0,s.mdx)("li",{parentName:"ul"},"commit: if true then the current document state is committed and a history state is created. If the second argument is false, then the document state is rolled back to the time when the state was suspended. This argument is optional and the default value is true. Photoshop only creates a history state if the document was modified between the calls to suspendHistory and resumeHistory.")),(0,s.mdx)("p",null,"When the modal scope ends, Photoshop will auto-resume history on any document that is still in a suspended state. If the target function for the modal scope returns normally, then all unsuspended states are committed. If the target function exits via an exception, then all unsuspended history states are cancelled."),(0,s.mdx)("h4",{id:"notifications"},"Notifications"),(0,s.mdx)("p",null,"When executeAsModal is active, then Photoshop notifications are silenced similar to when an action is run from the actions panel."),(0,s.mdx)("p",null,"This means that other plugins cannot listen for batchPlay commands that are executed while the modal scope is active."),(0,s.mdx)("p",null,"Plugins can register for notifications related to starting and ending a modal JavaScript scope by registering for the following events:"),(0,s.mdx)("ul",null,(0,s.mdx)("li",{parentName:"ul"},'"modalJavaScriptScopeEnter"'),(0,s.mdx)("li",{parentName:"ul"},'"modalJavaScriptScopeExit"')),(0,s.mdx)("h4",{id:"automatic-document-closing"},"Automatic document closing"),(0,s.mdx)("p",null,"When the user cancels a modal scope, then JavaScript cannot make any further document changes until it returns from the modal scope. In order to ensure proper clean up of temporary documents, JavaScript can register one or more documents to be automatically closed without saving when the modal scope ends. The following is an example of JavaScript that registers a document to be closed when the modal scope ends:"),(0,s.mdx)("pre",null,(0,s.mdx)("code",{parentName:"pre",className:"language-javascript"},"async function modalFunction(executionContext) {\n    let hostControl = executionContext.hostControl;\n\n    let docID = await createDocument();\n    await hostControl.registerAutoCloseDocument(docID);\n\n    ...\n}\n")),(0,s.mdx)("p",null,'JavaScript can unregister a document from being automatically closed by using unregisterAutoCloseDocument. The following illustrates JavaScript that creates and marks a document as "auto close" while the method is running. If the method succeeds then the document is unregistered from the set of auto close documents. This allows JavaScript to create a complete document, or close the document is the user cancels while the script is running.'),(0,s.mdx)("pre",null,(0,s.mdx)("code",{parentName:"pre",className:"language-javascript"},"async function modalFunction(executionContext) {\n    let hostControl = executionContext.hostControl;\n\n    let docID = await createDocument();\n    await hostControl.registerAutoCloseDocument(docID);\n\n    // Add contents to docID\n\n    ...\n\n    await hostControl.unregisterAutoCloseDocument(docID);\n}\n")),(0,s.mdx)("h4",{id:"notes"},"Notes"),(0,s.mdx)("p",null,"You can have nested modal scopes. A target function can use executeAsModal to execute another target function.\nAll modal scopes share the same global modal state. This mean that any nested scope can modify the state on the (single) progress bar. Similarly, you can suspend the history state of a document in one scope, and resume the state in another."))}d.isMDXComponent=!0}}]);
//# sourceMappingURL=component---src-pages-ps-reference-media-executeasmodal-md-60c0489fbe296a26b055.js.map